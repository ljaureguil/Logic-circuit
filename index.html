<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>HTML Document Template</title>
  <style>
  body{
      padding:16px;
      margin:5%;
      background:white;
  }
    p {
      font-family: Arial, sans-serif;
    }
.cios{
width:5%;
background:red;
margin:5px;
width:100px;


}
#dinputs{
    font-size:10px;
  
}
#doutputs{
    font-size:10px;
      width:45%;   
}
#todo{
    padding:5px;
}
#logiceditor{
    width:95%;
    height:150px;
}
#iodescription{
  position:absolute;
  right:5px;
  top:0%;
    font-size:12px;
    margin-left:10px;
    width: 5% ;
    height: 100px;

}
  </style>
</head>
<body>
  <div id="todo">
    <input id="name" type="text" placeholder="My Logic Circuit"></input>name<br>
<input id="inputs" type="number" value=8>number of inputs</input></br>
<input id="outputs" type="number" value=5>number of outputs</input></br>
<button onclick="setUpio()">Set Up ios</button>
<div style="border-style:solid;width: 80%;">
<div id="dinputs"></div>
<textarea id="logiceditor"></textarea>
<div id="doutputs"></div>
</div>
<div id="iodescription"></div>
<br>
<div id="men">
<button onclick="procesar()">Process</button>
<button onclick="sendObj()">Send to Web</button>
<select id="scirc" oninput="selc(this.value)">
  <option value="">Select Circuit</option>
</select>
</div>
</div>
  <script>

    var obj={},scr="",circuito={};
   circuito.name="";
    circuito.inputs=[];
    circuito.outputs=[];
    circuito.logic="";
    //obj.circuit={name:"",inputs:[],outputs:[]};

   function setUpio(v){
    iodescription.innerHTML="";
       dinputs.innerHTML="";doutputs.innerHTML=""
for(var i=0;i<inputs.value;i++){
  while(circuito.inputs.length>inputs.value) circuito.inputs.pop();
  while(circuito.outputs.length>outputs.value) circuito.outputs.pop();
  
dinputs.innerHTML+=`<input type="radio" id="ii`+i+`" class="cios cin" onclick="check(this)" value="off" ></input>i`+i;
iodescription.innerHTML+="i"+i+"<input type='text' style='width:90%;' placeholder='Desc, value'></input><br>";
var input={};
input.name="i"+i;
input.desc="";input.value=false;
input.connectTo=function(output){
    if(this.value) output.value=true;
    else output.value=false;
}
circuito.inputs.push(input);


}

for(var i=0;i<outputs.value;i++){
doutputs.innerHTML+=`<input  type="radio" id="oo`+i+`" class="cios cou" style='color:red;' ></input>o`+i;
iodescription.innerHTML+="o"+i+"<input type='text' style='width:90%;' placeholder='Desc, value'></input>";
eval("o"+i+"=false;");

var output={};
output.name="o"+i;
output.desc="";output.value=false;
output.connectFrom=function(input){
    if(input.value) this.value=true;
    else this.value=false;
}
circuito.outputs.push(output);

}


}

check = function(e){
 
    if(e.value==="on"){ e.checked=false;e.value="off"}
    else {e.checked=true;e.value="on"}
    procesar();
   // logiceditor.value+=e.id+": "+e.checked+" "
}

function procesar(){
var ai=document.getElementsByClassName("cin")

for(var i=0;i<ai.length;i++){
    eval("var i"+i+"="+ai[i].checked);
}

var ao=document.getElementsByClassName("cou");
/*ao.forEach(element => {
  element.checked=false;
});
*/

for(var i=0;i<ao.length;i++){
ao[i].checked=false;
    eval("var o"+i+"="+ao[i].checked);//var 
}

eval(logiceditor.value);
for(var i=0;i<ao.length;i++){
    //eval("var o"+i+"="+ao[i].checked);
    ao[i].checked=eval("o"+i);
    }
    circuito.logic=logiceditor.value;

}




var linklib="https://raw.githubusercontent.com/ljaureguil/My-Library/refs/heads/master/MyLibmin.js";
var link="https://api.jsonblob.com/019b80ce-bf27-7775-a066-af7b7869e5cf";//https://api.jsonblob.com/019b5163-39dc-74c4-b292-6655ebb3cf98"
var GetJson,UpdateJson;

loadDoc = function(url,callback) {

        var xhttp = new XMLHttpRequest();
        xhttp.open("GET", url, false);
        xhttp.send();
       if(callback!=undefined) callback(xhttp.responseText);
        return xhttp.responseText;
    }





loadDoc(linklib,function(data){
  //alert(data)
  scr=data;
  eval(data);

  GetJson(link,function(r){
//area.value=r.cont;
///
var fu=UpdateJson;
//alert(r.name)
UpdateJson=fu;
//alert(UpdateJson)
 obj=r;
 for(var i=0;i<obj.circuits.length;i++){
   var c=obj.circuits[i];
   var opt=document.createElement("option");
   opt.value=c.name;
   opt.innerHTML=c.name;
   scirc.appendChild(opt);  


  };
})
});

function sendObj(){ 
  eval(scr);
 //  alert(UpdateJson)
 //obj.cont=area.value;
 var n=prompt("Name of the circuit",circuito.name);
  if(n!=null) circuito.name=n;
  else return;
  obj.circuits.push(circuito);
 
UpdateJson(link,obj,function(r){
    alert("all done");
  });
}

function   readData(){

  GetJson(link,function(r){
    obj=r;   
  //  area.value=obj.cont;
  });
} 

function selc(v){
  if(v=="") return;
  var c=obj.circuits.find(c=>c.name==v);
  if(c==undefined) return;
  circuito=c;
  logiceditor.value=circuito.logic;
  inputs.value=circuito.inputs.length;
  outputs.value=circuito.outputs.length;
  setUpio();

 /* for(var i=0;i<circuito.inputs.length;i++){  
    var ii=document.getElementById("ii"+i);
    if(ii!=undefined){
        ii.checked=circuito.inputs[i].value;
    }
  }
  for(var i=0;i<circuito.outputs.length;i++){
    var oo=document.getElementById("oo"+i);
    if(oo!=undefined){
        oo.checked=circuito.outputs[i].value;
    }
  }*/
}




  </script>
</body>
</html>
